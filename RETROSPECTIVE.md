# 振り返り：PRV-23〜31 の開発フロー反省

## やってしまったこと

merge なしで cherry-pick を積み重ねる開発をしてしまった。

```
main（変化なし）
├── PR#3: [PRV-23]
├── PR#4: [PRV-23 cherry-pick] + [PRV-24]
├── PR#5: [PRV-23〜24 cherry-pick] + [PRV-25]
├── PR#6: [PRV-23〜25 cherry-pick] + [PRV-26]
...
```

## 何が問題だったか

1. **PR の diff が肥大化**
   - PR #8 を開くと PRV-29〜31 の実装だけでなく全コードが差分として表示される
   - レビューする意味がなくなる

2. **コミット履歴が汚れる**
   - cherry-pick は SHA が異なる別コミット
   - 順番に merge すれば動作上は通るが、同じ内容のコミットが重複する

3. **順番依存が隠れる**
   - 各ブランチが何に依存しているか PR を見ても分からない

## 本来あるべき姿

### ソロ開発（この規模が該当）

```
main ──▶ PRV-23 → merge ──▶ PRV-24 → merge ──▶ PRV-25 → merge ...
```

- PR を出したらすぐレビュー → merge
- 次のブランチは常に最新の main から切る
- PR の diff は「そのイシューの変更だけ」になる

### 並行開発が許されるのは独立している場合のみ

```
main ─┬── feature/A（tagger）    ← 他に依存しない
      └── feature/B（summarizer） ← 他に依存しない
```

PRV-23〜31 は互いに依存しているので本来は並行 NG。

### 大規模チームの場合は PR スタック

```
main ← PRV-23 ← PRV-24 ← PRV-25 ...
```

Graphite / ghstack 等のツールを使う。

## 今後の対応

1. PR #3〜#8 を番号順（#3→#4→...→#8）に merge する
   - git の 3-way merge がコンテンツ同一性を見て競合なく通る
2. PRV-32 以降は **merge 済みの main から切る**
3. Claude への指示として「次のイシューに進む前に merge を確認する」

## 教訓

> 「次のイシューを実装する前に、前の PR を merge してから進める」

Claude は「続けて」と言われると merge を待たずに次へ進もうとする。
ユーザー側でブレーキをかけるか、Claude に「merge 待ちの PR がある場合は確認を促す」よう指示すると良い。
